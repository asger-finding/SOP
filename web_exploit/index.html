<html>

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Roulette</title>
	<style>
		body {
			margin: 0;
			padding: 40px;
			font-family: system-ui;
			background: #1a1a1a;
			color: #ffffff;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			min-height: 100vh;
			overflow-y: hidden;
		}

		#roulette {
			position: relative;
			width: 416px;
			height: 416px;
			overflow: hidden;
		}

		#wheel {
			position: relative;
			width: 400px;
			height: 400px;
			border-radius: 50%;
			border: 8px solid #d4af37;
			overflow: hidden;
			transition: transform 3s cubic-bezier(0.17, 0.67, 0.12, 0.99);
		}

		.slot {
			position: absolute;
			inset: 0;
			transform-origin: center center;
			transform: rotate(calc(var(--i) * 10deg - 95deg));
			clip-path: polygon(50% 50%,
					100% 50%,
					100% calc(50% + 35.5px),
					50% 50%);
		}

		.slot:nth-child(odd) {
			background: #c41e3a;
		}

		.slot:nth-child(even) {
			background: #000;
		}

		.slot span {
			position: absolute;
			top: 50%;
			left: 100%;
			transform: translate(-30px, 10px);
			transform-origin: 50% 100%;
			font-size: 14px;
			pointer-events: none;
		}

		#result {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			width: 80px;
			height: 80px;
			border-radius: 50%;
			background: #2a2a2a;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 32px;
			font-weight: bold;
			color: #d4af37;
		}

		#marker {
			position: absolute;
			top: -10px;
			left: 50%;
			transform: translateX(-50%);
			width: 0;
			height: 0;
			border-left: 15px solid transparent;
			border-right: 15px solid transparent;
			border-top: 25px solid #d4af37;
			filter: drop-shadow(0 3px 5px #000000bd)
		}

		button {
			margin-top: 40px;
			padding: 16px 48px;
			font-size: 18px;
			background: #d4af37;
			color: #000;
			border: none;
			border-radius: 8px;
			cursor: pointer;
			font-weight: bold;
			transition: background 0.2s;
		}

		button:hover:not(:disabled) {
			background: #e5c048;
		}

		button:disabled {
			opacity: 0.5;
			cursor: not-allowed;
		}

		.history {
			min-height: 70px;
			margin-top: 30px;
			padding: 20px;
			background: #2a2a2a;
			border-radius: 8px;
			min-width: 300px;
			text-align: center;
		}

		.history h3 {
			margin: 0 0 10px 0;
			color: #d4af37;
		}

		.numbers {
			display: flex;
			flex-wrap: wrap;
			gap: 8px;
			justify-content: center;
		}

		.num {
			width: 36px;
			height: 36px;
			display: flex;
			align-items: center;
			justify-content: center;
			border-radius: 4px;
			background: #3a3a3a;
			font-weight: bold;
		}
	</style>

	<script>
		document.addEventListener('DOMContentLoaded', () => {
			const wheel = document.getElementById('wheel');
			const result = document.getElementById('result');
			const spinBtn = document.getElementById('spinBtn');
			const history = document.getElementById('history');

			let lastRotation = 0;
			let numbers = [];

			for (let i = 0; i < 36; i++) {
				const slot = document.createElement('div');
				slot.className = 'slot';
				slot.style.setProperty('--i', i);
				slot.innerHTML = `<span>${36 - i}</span>`;

				wheel.appendChild(slot);
			}

			spinBtn.addEventListener('click', async () => {
				spinBtn.disabled = true;
				result.textContent = ' ';

				const response = await fetch('/spin');
				const data = await response.json();
				const number = data.number;

				const sector = 360 / 36;
				const extraRotation = 5 * 360
				const rotation = ((36 - (numbers[numbers.length - 1] || 0) + number) % 36) * sector
					+ lastRotation
					+ extraRotation;
				wheel.style.transform = `rotate(${rotation}deg)`;
				lastRotation = rotation;

				setTimeout(() => {
					numbers.push(number);
					updateHistory();

					result.textContent = number;
					spinBtn.disabled = false;
				}, 3000);
			});

			const updateHistory = () => document.getElementById('history').innerHTML = numbers.map(n =>
				`<div class="num">${n}</div>`
			).join('');
		});
	</script>
</head>

<body>

	<div id="roulette">
		<div id="wheel"></div>
		<div id="marker"></div>
		<div id="result"> </div>
	</div>

	<button id="spinBtn">Spin</button>

	<div class="history">
		<h3>Tidligere resultater</h3>
		<div class="numbers" id="history"></div>
	</div>
</body>

</html>
