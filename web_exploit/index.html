<html>

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Roulette</title>
	<style>
		body {
			margin: 0;
			padding: 40px;
			font-family: system-ui;
			background: #ffffff;
			color: #000000;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			min-height: 100vh;
			overflow-y: hidden;
		}

		#roulette {
			position: relative;
			width: 416px;
			height: 416px;
			overflow: hidden;
		}

		#wheel {
			position: relative;
			width: 400px;
			height: 400px;
			border-radius: 50%;
			border: 8px solid #d4af37;
			overflow: hidden;
			transition: transform 2s cubic-bezier(0.17, 0.67, 0.12, 0.99);
		}

		.slot {
			position: absolute;
			inset: 0;
			transform-origin: center center;
			transform: rotate(calc(var(--i) * 10deg - 90deg));
			clip-path: polygon(50% 50%,
					100% 50%,
					100% calc(50% + 35.5px),
					50% 50%);
		}

		.slot:nth-child(odd) {
			background: #c41e3a;
		}

		.slot:nth-child(even) {
			background: #000000;
		}

		.slot span {
			color: #ffffff;
			font-weight: bold;
			position: absolute;
			top: 50%;
			left: 100%;
			transform: translate(-30px, 10px);
			transform-origin: 50% 100%;
			font-size: 14px;
			pointer-events: none;
		}

		#result {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			width: 80px;
			height: 80px;
			border-radius: 50%;
			background: #281a05;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 32px;
			font-weight: bold;
			color: #d4af37;
		}

		#marker {
			position: absolute;
			top: -10px;
			left: 50%;
			transform: translateX(-50%);
			width: 0;
			height: 0;
			border-left: 15px solid transparent;
			border-right: 15px solid transparent;
			border-top: 25px solid #d4af37;
			filter: drop-shadow(0 3px 5px #000000bd)
		}

		#betInput {
			padding: 16px;
			font-size: 18px;
			width: 150px;
			border-radius: 8px;
			border: none;
			background: #cda05e;
			color: #ffffff;
			font-weight: bold;
			text-align: center;
		}

		#betInput::placeholder {
			color: #ffffff;
			opacity: 0.6;
		}

		#spinButton {
			padding: 16px 48px;
			font-size: 18px;
			background: #d4af37;
			color: #000000;
			border: none;
			border-radius: 8px;
			cursor: pointer;
			font-weight: bold;
			transition: background 0.2s;
		}

		#spinButton:hover:not(:disabled) {
			background: #e5c048;
		}

		#spinButton:disabled {
			opacity: 0.5;
			cursor: not-allowed;
		}

		.history {
			min-height: 70px;
			margin-top: 30px;
			padding: 20px;
			background: #cda05e;
			border-radius: 8px;
			min-width: 300px;
			text-align: center;
		}

		.history h3 {
			margin: 0 0 10px 0;
			color: #ffffff;
		}

		.numbers {
			display: flex;
			flex-wrap: wrap;
			gap: 8px;
			justify-content: center;
		}

		.num {
			color: #ffffff;
			width: 36px;
			height: 36px;
			display: flex;
			align-items: center;
			justify-content: center;
			border-radius: 4px;
			background: #3a3a3a;
			font-weight: bold;
		}

		.num.win {
			background: #00aa00;
		}

		.num.loss {
			background: #aa0000;
		}
	</style>

	<script>
		document.addEventListener('DOMContentLoaded', () => {
			const wheel = document.getElementById('wheel');
			const result = document.getElementById('result');
			const spinButton = document.getElementById('spinButton');
			const betInput = document.getElementById('betInput');
			const history = document.getElementById('history');

			let lastRotation = 0;
			let results = [];

			for (let i = 0; i < 36; i++) {
				const slot = document.createElement('div');
				slot.className = 'slot';
				slot.style.setProperty('--i', i);
				slot.innerHTML = `<span>${36 - i}</span>`;

				wheel.appendChild(slot);
			}

			spinButton.addEventListener('click', async () => {
				spinButton.disabled = true;
				result.textContent = ' ';

				const bet = parseInt(betInput.value) || null;
				const url = bet ? `/spin?bet=${bet}` : '/spin';

				const response = await fetch(url);
				const data = await response.json();
				const { number, rotation, won } = data;

				// The rotation starts from zero,
				// so we animate with our last culminative rotation
				// with the shift of the previous rotation
				// and some extra rotations for dramatic effect
				const sector = 360 / 36;
				const extraRotation = 3 * 360;
				const computedRotation = ((360 - (results[results.length - 1]?.rotation || 0) + rotation) % 360)
					+ lastRotation
					+ extraRotation;
				wheel.style.transform = `rotate(${computedRotation}deg)`;
				lastRotation = computedRotation;

				setTimeout(() => {
					results.push({ number, rotation, bet, won });
					updateHistory();

					result.textContent = number;
					spinButton.disabled = false;
				}, 2000);
			});

			const updateHistory = () => history.innerHTML = results.map(response => {
				let className = 'num';
				if (response.bet !== null) className += response.won ? ' win' : ' loss';

				return `<div class="${className}">${response.number}</div>`;
			}).join('');
		});
	</script>
</head>

<body>

	<div id="roulette">
		<div id="wheel"></div>
		<div id="marker"></div>
		<div id="result"> </div>
	</div>

	<div style="display: flex; gap: 12px; align-items: center; margin-top: 40px;">
		<input id="betInput" type="number" id="betInput" min="1" max="36" placeholder="GÃ¦t (1-36)">
		<button id="spinButton">Spin</button>
	</div>

	<div class="history">
		<h3>Tidligere resultater</h3>
		<div class="numbers" id="history"></div>
	</div>
</body>

</html>